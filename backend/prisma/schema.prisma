generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum PrivacyLevel {
  PRIVATE
  PUBLIC
}

enum RelationshipType {
  FRIEND
  FAMILY
  COLLEAGUE
  SERVICE_PROVIDER
  ACQUAINTANCE
  KNOWN_TO_EACH_OTHER
  OTHER
}

// User model
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  contacts Contact[]
}

// Contact model
model Contact {
  id           Int          @id @default(autoincrement())
  name         String
  phone        String?
  email        String?
  address      String?
  notes        String?
  privacyLevel PrivacyLevel @default(PRIVATE)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  userId Int
  user   User @relation(fields: [userId], references: [id])

  relationships Relationship[] @relation("ContactRelations")
  relatedTo     Relationship[] @relation("RelatedToRelations")
}

// Relationship model
model Relationship {
  id               Int              @id @default(autoincrement())
  contactId        Int
  relatedContactId Int
  relationshipType RelationshipType
  strength         Int              @default(5)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  contact        Contact @relation("ContactRelations", fields: [contactId], references: [id])
  relatedContact Contact @relation("RelatedToRelations", fields: [relatedContactId], references: [id])

  @@index([contactId])
  @@index([relatedContactId])
  @@index([relationshipType])
}
